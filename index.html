<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Risk Leaderboard - Live Sync</title>
<link href="https://fonts.googleapis.com/css2?family=Figtree:wght@700;800&family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  body { margin: 0; padding: 0; font-family: 'Figtree', 'Kanit', sans-serif; background-color: #ffffff; }
  .leaderboard-container { max-width: 1200px; margin: 0 auto; padding: 60px 40px; display: flex; align-items: center; gap: 60px; box-sizing: border-box; }
  .stats-side { flex: 1; }
  .header-box { border-left: 6px solid #007947; padding-left: 25px; margin-bottom: 40px; }
  .main-title { font-size: 48px; font-weight: 800; color: #007947; margin: 0; line-height: 1; }
  .sub-title { font-size: 22px; font-weight: 400; color: #555; margin: 8px 0 0 0; }
  
  .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px; }
  .stat-card { background: #f8f9fa; padding: 25px 20px; border-radius: 20px; text-align: center; border: 1px solid #eee; transition: transform 0.3s ease; }
  .stat-card:hover { transform: translateY(-5px); border-color: #007947; }
  .stat-value { display: block; font-size: 36px; font-weight: 800; color: #007947; }
  .stat-label { font-size: 16px; color: #666; margin-top: 5px; }

  .btn-full-rank { display: inline-flex; align-items: center; background-color: #007947; color: white; text-decoration: none; font-size: 18px; font-weight: 600; padding: 16px 40px; border-radius: 50px; box-shadow: 0 10px 20px rgba(0, 121, 71, 0.2); transition: all 0.3s ease; }
  .btn-full-rank:hover { background-color: #005a35; transform: translateY(-3px); box-shadow: 0 15px 30px rgba(0, 121, 71, 0.3); }

  .podium-side { flex: 1.2; display: flex; align-items: flex-end; justify-content: center; gap: 15px; padding-top: 40px; }
  .podium-item { display: flex; flex-direction: column; align-items: center; flex: 1; min-width: 100px; }
  .base { width: 100%; border-radius: 15px 15px 0 0; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-weight: 800; font-size: 28px; position: relative; }
  .winner-name { margin-bottom: 12px; font-size: 15px; font-weight: 600; color: #333; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center; }

  .rank-1 .base { height: 200px; background: #ffcc00; box-shadow: 0 10px 30px rgba(255, 204, 0, 0.4); }
  .rank-2 .base { height: 140px; background: #c0c0c0; }
  .rank-3 .base { height: 100px; background: #cd7f32; }
  .medal-icon { font-size: 44px; margin-bottom: 5px; }

  @media (max-width: 950px) {
    .leaderboard-container { flex-direction: column; text-align: center; padding: 40px 20px; }
    .header-box { border-left: none; border-bottom: 4px solid #007947; padding-bottom: 15px; }
    .podium-side { width: 100%; gap: 10px; }
  }
</style>
</head>
<body>

  <div class="leaderboard-container">
    <div class="stats-side">
      <div class="header-box">
        <h1 class="main-title">Risk Leaderboard</h1>
        <p class="sub-title">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</p>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-value" id="total-players">-</span>
          <span class="stat-label">‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="max-score">-</span>
          <span class="stat-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span>
        </div>
      </div>

      <a href="https://risk-for-fun-score-ten.vercel.app/#/" target="_blank" class="btn-full-rank">
        ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏°
        <svg style="margin-left: 10px" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
      </a>
    </div>

    <div class="podium-side">
      <div class="podium-item rank-2">
        <div class="winner-name" id="name-2">...</div>
        <div class="base"><span class="medal-icon">ü•à</span> 2</div>
      </div>
      <div class="podium-item rank-1">
        <div class="winner-name" id="name-1">...</div>
        <div class="base"><span class="medal-icon">üëë</span> 1</div>
      </div>
      <div class="podium-item rank-3">
        <div class="winner-name" id="name-3">...</div>
        <div class="base"><span class="medal-icon">ü•â</span> 3</div>
      </div>
    </div>
  </div>

  <script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRM_q1vwgV6Iy_2AUsEJxdbkR8x46I-F-DO7I2Kd7kckGUnwpOAxNXTeUE3Te6OjhzPY8dIEKUKhz-X/pub?output=csv';

    async function updateLeaderboard() {
      try {
        const response = await fetch(sheetUrl);
        const csvText = await response.text();
        
        // ‡πÅ‡∏¢‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
        const rows = csvText.split('\n').filter(row => row.trim() !== '');
        
        // ‡πÉ‡∏ä‡πâ Map ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á
        const playerMap = {};

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ñ‡∏ß 1 (‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠)
        rows.slice(1).forEach(row => {
          const cols = row.split(',');
          // Index 1 = employeeId, Index 2 = employeeName, Index 8 = totalScore
          const empId = cols[1]?.trim();
          const empName = cols[2]?.trim().replace(/"/g, '');
          const score = parseInt(cols[8]) || 0;

          if (empId) {
            if (!playerMap[empId]) {
              playerMap[empId] = { name: empName, score: 0 };
            }
            playerMap[empId].score += score;
          }
        });

        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Array ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö
        const sortedPlayers = Object.values(playerMap).sort((a, b) => b.score - a.score);

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        document.getElementById('total-players').innerText = Object.keys(playerMap).length.toLocaleString();
        document.getElementById('max-score').innerText = sortedPlayers.length > 0 ? sortedPlayers[0].score.toLocaleString() : 0;

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ô‡πÇ‡∏û‡πÄ‡∏î‡∏µ‡∏¢‡∏°
        if (sortedPlayers[0]) document.getElementById('name-1').innerText = sortedPlayers[0].name;
        if (sortedPlayers[1]) document.getElementById('name-2').innerText = sortedPlayers[1].name;
        if (sortedPlayers[2]) document.getElementById('name-3').innerText = sortedPlayers[2].name;

      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    updateLeaderboard();
    setInterval(updateLeaderboard, 300000); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ
  </script>
</body>
</html>
